<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reportes TÃ©cnicos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #3b82f6;
            --accent: #7c3aed;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--gray);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .form-section {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .photo-upload {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .photo-upload:hover {
            border-color: var(--primary);
        }
        
        .photo-upload i {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .photo-item {
            width: 150px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .photo-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .photo-caption {
            padding: 8px;
            font-size: 14px;
            text-align: center;
            background-color: #f8f9fa;
        }
        
        .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--danger);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .table th, .table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 2px solid white;
            margin-bottom: -2px;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .signature-pad {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        
        .signature-container {
            border: 1px dashed #ddd;
            height: 150px;
            margin-bottom: 15px;
            background-color: white;
            cursor: crosshair;
        }
        
        .air-conditioner-section {
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            background-color: #f0f7ff;
        }
        
        .air-conditioner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .air-conditioner-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .remove-air-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        .loading-text {
            font-size: 1.2rem;
            color: var(--dark);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .photo-item {
                width: 100%;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Generando PDF...</div>
    </div>
    
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <h2 class="modal-title">Enviar Reporte por Correo</h2>
            <div class="form-group">
                <label for="emailTo">Destinatario</label>
                <input type="email" id="emailTo" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="emailSubject">Asunto</label>
                <input type="text" id="emailSubject" class="form-control">
            </div>
            <div class="form-group">
                <label for="emailMessage">Mensaje</label>
                <textarea id="emailMessage" class="form-control" rows="4"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelEmail">Cancelar</button>
                <button class="btn btn-success" id="sendEmail">Enviar</button>
            </div>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo"><i class="fas fa-file-contract"></i> ReportesTÃ©cnicos</a>
                <div>
                    <button class="btn btn-secondary" id="saveBtn"><i class="fas fa-save"></i> Guardar</button>
                    <button class="btn btn-success" id="generatePdf"><i class="fas fa-file-pdf"></i> Generar PDF</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="form-section">
            <h2 class="section-title">InformaciÃ³n General del Sitio</h2>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="pais">PaÃ­s</label>
                        <input type="text" id="pais" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="fecha">Fecha</label>
                        <input type="date" id="fecha" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="identificador">Identificador</label>
                        <input type="text" id="identificador" class="form-control">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="idSitio">ID Sitio</label>
                        <input type="text" id="idSitio" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="nombreSitio">Nombre Sitio</label>
                        <input type="text" id="nombreSitio" class="form-control">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="region">RegiÃ³n</label>
                        <input type="text" id="region" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="departamento">Departamento</label>
                        <input type="text" id="departamento" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="tipoSitio">Tipo</label>
                        <input type="text" id="tipoSitio" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="categoria">CategorÃ­a</label>
                        <input type="text" id="categoria" class="form-control">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="latitud">Latitud</label>
                        <input type="text" id="latitud" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="longitud">Longitud</label>
                        <input type="text" id="longitud" class="form-control">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="supervisor">Supervisor</label>
                        <input type="text" id="supervisor" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="supervisorClaro">Supervisor Claro</label>
                        <input type="text" id="supervisorClaro" class="form-control">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="empresa">Empresa</label>
                        <input type="text" id="empresa" class="form-control">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="tecnico">TÃ©cnico</label>
                        <input type="text" id="tecnico" class="form-control">
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="aire">Aire Acondicionado</div>
                <div class="tab" data-tab="energia">EnergÃ­a</div>
                <div class="tab" data-tab="infraestructura">Infraestructura</div>
                <div class="tab" data-tab="rectificadores">Rectificadores</div>
                <div class="tab" data-tab="tierras">Sistemas de Tierras</div>
            </div>
            
            <div class="tab-content active" id="aire-content">
                <div id="aires-container">
                    <!-- SecciÃ³n para el primer aire acondicionado -->
                    <div class="air-conditioner-section" id="air-section-1">
                        <div class="air-conditioner-header">
                            <div class="air-conditioner-title">Aire Acondicionado #1</div>
                            <button class="remove-air-btn" data-air-id="1" style="display: none;">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="tipoAire1">Tipo de Aire</label>
                                    <select id="tipoAire1" class="form-control">
                                        <option value="" selected disabled>Seleccione el tipo</option>
                                        <option value="MINI SPLIT">MINI SPLIT</option>
                                        <option value="SPLIT">SPLIT</option>
                                        <option value="VENTANA">VENTANA</option>
                                        <option value="PRECISIÃN">PRECISIÃN</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="capacidadAire1">Capacidad del Aire (BTU)</label>
                                    <input type="number" id="capacidadAire1" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="marcaEquipo1">Marca del equipo</label>
                                    <input type="text" id="marcaEquipo1" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="serieEquipo1">Serie del equipo</label>
                                    <input type="text" id="serieEquipo1" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="modeloEquipo1">Modelo del equipo</label>
                                    <input type="text" id="modeloEquipo1" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="refrigerante1">Refrigerante</label>
                                    <input type="text" id="refrigerante1" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Â¿El equipo cuenta con Activo Claro?</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="radio" id="activoClaroSi1" name="activoClaro1" value="Si">
                                    <label for="activoClaroSi1">SÃ­</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="radio" id="activoClaroNo1" name="activoClaro1" value="No" checked>
                                    <label for="activoClaroNo1">No</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" id="activoClaroContainer1" style="display: none;">
                            <label for="activoClaroCodigo1">Activo Claro</label>
                            <input type="text" id="activoClaroCodigo1" class="form-control">
                        </div>
                        
                        <h3 class="section-title">Mediciones del Equipo de Enfriamiento</h3>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="setTemperatura1">Set de Temperatura (Â°C)</label>
                                    <input type="number" id="setTemperatura1" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Â¿Se realizaron las pruebas de presiÃ³n del refrigerante?</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="radio" id="pruebaPresionSi1" name="pruebaPresion1" value="Si">
                                            <label for="pruebaPresionSi1">SÃ­</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" id="pruebaPresionNo1" name="pruebaPresion1" value="No" checked>
                                            <label for="pruebaPresionNo1">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="presionAlta1">PresiÃ³n ALTA (PSI)</label>
                                    <input type="number" id="presionAlta1" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="presionBaja1">PresiÃ³n BAJA (PSI)</label>
                                    <input type="number" id="presionBaja1" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <h3 class="section-title">Voltaje que maneja el equipo</h3>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mediciones de Voltajes</th>
                                    <th>Valor (V)</th>
                                    <th>Mediciones de Voltajes</th>
                                    <th>Valor (V)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>L1-N</td>
                                    <td><input type="number" class="form-control" step="0.01"></td>
                                    <td>L1-L2</td>
                                    <td><input type="number" class="form-control" step="0.01"></td>
                                </tr>
                                <tr>
                                    <td>L2-N</td>
                                    <td><input type="number" class="form-control" step="0.01"></td>
                                    <td>L1-L3</td>
                                    <td><input type="text" class="form-control"></td>
                                </tr>
                                <tr>
                                    <td>L3-N</td>
                                    <td><input type="text" class="form-control"></td>
                                    <td>L2-L3</td>
                                    <td><input type="text" class="form-control"></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h3 class="section-title">MediciÃ³n de Corrientes (AMP)</h3>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="corrienteL1_1">L1</label>
                                    <input type="number" id="corrienteL1_1" class="form-control" step="0.01">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="corrienteL2_1">L2</label>
                                    <input type="number" id="corrienteL2_1" class="form-control" step="0.01">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="corrienteL3_1">L3</label>
                                    <input type="text" id="corrienteL3_1" class="form-control">
                                </div>
                            </div>
                        </div>
                        
                        <h3 class="section-title">Sala de funcionamiento del AA</h3>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="tempAmbiente1">Temperatura Ambiente (Â°C)</label>
                                    <input type="number" id="tempAmbiente1" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="capBreaker1">Capacidad del Breaker (AMP)</label>
                                    <input type="number" id="capBreaker1" class="form-control" step="0.01">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="puestaTierra1">Puesta a Tierra del equipo (Î©)</label>
                                    <input type="number" id="puestaTierra1" class="form-control" step="0.01">
                                </div>
                            </div>
                        </div>
                        
                        <h3 class="section-title">FotografÃ­as del Equipo</h3>
                        
                        <div class="form-group">
                            <label>Evidencia de limpieza del equipo</label>
                            <div class="photo-upload" onclick="document.getElementById('fotoLimpieza1').click()">
                                <i class="fas fa-camera"></i>
                                <p>Haga clic para agregar fotos de limpieza (Antes, Durante, DespuÃ©s)</p>
                                <input type="file" id="fotoLimpieza1" accept="image/*" multiple style="display: none;">
                            </div>
                            <div class="photo-preview" id="fotoLimpiezaPreview1"></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Evidencia de estado del equipo</label>
                            <div class="photo-upload" onclick="document.getElementById('fotoEstado1').click()">
                                <i class="fas fa-camera"></i>
                                <p>Haga clic para agregar fotos del estado del equipo</p>
                                <input type="file" id="fotoEstado1" accept="image/*" multiple style="display: none;">
                            </div>
                            <div class="photo-preview" id="fotoEstadoPreview1"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Â¿Cuenta con otro Aire Acondicionado?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="otroAireSi" name="otroAire" value="Si">
                            <label for="otroAireSi">SÃ­</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="otroAireNo" name="otroAire" value="No" checked>
                            <label for="otroAireNo">No</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button class="btn" id="addAirConditioner"><i class="fas fa-plus"></i> Agregar Aire Acondicionado</button>
                </div>
            </div>
            
            <div class="tab-content" id="energia-content">
                <div class="form-section">
                    <h2 class="section-title">InformaciÃ³n de EnergÃ­a</h2>
                    <p>Formulario de energÃ­a en desarrollo...</p>
                </div>
            </div>
            
            <div class="tab-content" id="infraestructura-content">
                <div class="form-section">
                    <h2 class="section-title">InformaciÃ³n de Infraestructura</h2>
                    <p>Formulario de infraestructura en desarrollo...</p>
                </div>
            </div>
            
            <div class="tab-content" id="rectificadores-content">
                <div class="form-section">
                    <h2 class="section-title">InformaciÃ³n de Rectificadores</h2>
                    <p>Formulario de rectificadores en desarrollo...</p>
                </div>
            </div>
            
            <div class="tab-content" id="tierras-content">
                <div class="form-section">
                    <h2 class="section-title">InformaciÃ³n de Sistemas de Tierras</h2>
                    <p>Formulario de sistemas de tierras en desarrollo...</p>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">Observaciones Generales</h2>
            <div class="form-group">
                <label for="observaciones">Escriba aquÃ­ cualquier observaciÃ³n adicional</label>
                <textarea id="observaciones" class="form-control" rows="4"></textarea>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">Firma del TÃ©cnico</h2>
            <div class="signature-pad">
                <div class="signature-container" id="signaturePad"></div>
                <button class="btn btn-secondary" id="clearSignature"><i class="fas fa-eraser"></i> Limpiar Firma</button>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-secondary" id="resetForm"><i class="fas fa-trash"></i> Limpiar Formulario</button>
            <button class="btn" id="submitForm"><i class="fas fa-paper-plane"></i> Enviar Reporte</button>
        </div>
    </div>

    <script>
        // Inicializar EmailJS (reemplaza con tu User ID)
        emailjs.init("TU_USER_ID_DE_EMAILJS");
        
        // Contador de aires acondicionados
        let airCounter = 1;
        let generatedPdf = null;
        
        // Manejo de pestaÃ±as
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-content`).classList.add('active');
            });
        });

        // Mostrar/ocultar campo de Activo Claro segÃºn selecciÃ³n
        document.querySelectorAll('input[name^="activoClaro"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const airId = this.name.replace('activoClaro', '');
                const container = document.getElementById(`activoClaroContainer${airId}`);
                container.style.display = this.value === 'Si' ? 'block' : 'none';
            });
        });

        // FunciÃ³n para agregar un nuevo aire acondicionado
        document.getElementById('addAirConditioner').addEventListener('click', function() {
            airCounter++;
            
            const newAirSection = document.createElement('div');
            newAirSection.className = 'air-conditioner-section';
            newAirSection.id = `air-section-${airCounter}`;
            
            newAirSection.innerHTML = `
                <div class="air-conditioner-header">
                    <div class="air-conditioner-title">Aire Acondicionado #${airCounter}</div>
                    <button class="remove-air-btn" data-air-id="${airCounter}">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="tipoAire${airCounter}">Tipo de Aire</label>
                            <select id="tipoAire${airCounter}" class="form-control">
                                <option value="" selected disabled>Seleccione el tipo</option>
                                <option value="MINI SPLIT">MINI SPLIT</option>
                                <option value="SPLIT">SPLIT</option>
                                <option value="VENTANA">VENTANA</option>
                                <option value="PRECISIÃN">PRECISIÃN</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="capacidadAire${airCounter}">Capacidad del Aire (BTU)</label>
                            <input type="number" id="capacidadAire${airCounter}" class="form-control">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="marcaEquipo${airCounter}">Marca del equipo</label>
                            <input type="text" id="marcaEquipo${airCounter}" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="serieEquipo${airCounter}">Serie del equipo</label>
                            <input type="text" id="serieEquipo${airCounter}" class="form-control">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="modeloEquipo${airCounter}">Modelo del equipo</label>
                            <input type="text" id="modeloEquipo${airCounter}" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="refrigerante${airCounter}">Refrigerante</label>
                            <input type="text" id="refrigerante${airCounter}" class="form-control">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Â¿El equipo cuenta con Activo Claro?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="radio" id="activoClaroSi${airCounter}" name="activoClaro${airCounter}" value="Si">
                            <label for="activoClaroSi${airCounter}">SÃ­</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="radio" id="activoClaroNo${airCounter}" name="activoClaro${airCounter}" value="No" checked>
                            <label for="activoClaroNo${airCounter}">No</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group" id="activoClaroContainer${airCounter}" style="display: none;">
                    <label for="activoClaroCodigo${airCounter}">Activo Claro</label>
                    <input type="text" id="activoClaroCodigo${airCounter}" class="form-control">
                </div>
                
                <h3 class="section-title">Mediciones del Equipo de Enfriamiento</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="setTemperatura${airCounter}">Set de Temperatura (Â°C)</label>
                            <input type="number" id="setTemperatura${airCounter}" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Â¿Se realizaron las pruebas de presiÃ³n del refrigerante?</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="radio" id="pruebaPresionSi${airCounter}" name="pruebaPresion${airCounter}" value="Si">
                                    <label for="pruebaPresionSi${airCounter}">SÃ­</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="radio" id="pruebaPresionNo${airCounter}" name="pruebaPresion${airCounter}" value="No" checked>
                                    <label for="pruebaPresionNo${airCounter}">No</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="presionAlta${airCounter}">PresiÃ³n ALTA (PSI)</label>
                            <input type="number" id="presionAlta${airCounter}" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="presionBaja${airCounter}">PresiÃ³n BAJA (PSI)</label>
                            <input type="number" id="presionBaja${airCounter}" class="form-control">
                        </div>
                    </div>
                </div>
                
                <h3 class="section-title">Voltaje que maneja el equipo</h3>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th>Mediciones de Voltajes</th>
                            <th>Valor (V)</th>
                            <th>Mediciones de Voltajes</th>
                            <th>Valor (V)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>L1-N</td>
                            <td><input type="number" class="form-control" step="0.01"></td>
                            <td>L1-L2</td>
                            <td><input type="number" class="form-control" step="0.01"></td>
                        </tr>
                        <tr>
                            <td>L2-N</td>
                            <td><input type="number" class="form-control" step="0.01"></td>
                            <td>L1-L3</td>
                            <td><input type="text" class="form-control"></td>
                        </tr>
                        <tr>
                            <td>L3-N</td>
                            <td><input type="text" class="form-control"></td>
                            <td>L2-L3</td>
                            <td><input type="text" class="form-control"></td>
                        </tr>
                    </tbody>
                </table>
                
                <h3 class="section-title">MediciÃ³n de Corrientes (AMP)</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="corrienteL1_${airCounter}">L1</label>
                            <input type="number" id="corrienteL1_${airCounter}" class="form-control" step="0.01">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="corrienteL2_${airCounter}">L2</label>
                            <input type="number" id="corrienteL2_${airCounter}" class="form-control" step="0.01">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="corrienteL3_${airCounter}">L3</label>
                            <input type="text" id="corrienteL3_${airCounter}" class="form-control">
                        </div>
                    </div>
                </div>
                
                <h3 class="section-title">Sala de funcionamiento del AA</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="tempAmbiente${airCounter}">Temperatura Ambiente (Â°C)</label>
                            <input type="number" id="tempAmbiente${airCounter}" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="capBreaker${airCounter}">Capacidad del Breaker (AMP)</label>
                            <input type="number" id="capBreaker${airCounter}" class="form-control" step="0.01">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="puestaTierra${airCounter}">Puesta a Tierra del equipo (Î©)</label>
                            <input type="number" id="puestaTierra${airCounter}" class="form-control" step="0.01">
                        </div>
                    </div>
                </div>
                
                <h3 class="section-title">FotografÃ­as del Equipo</h3>
                
                <div class="form-group">
                    <label>Evidencia de limpieza del equipo</label>
                    <div class="photo-upload" onclick="document.getElementById('fotoLimpieza${airCounter}').click()">
                        <i class="fas fa-camera"></i>
                        <p>Haga clic para agregar fotos de limpieza (Antes, Durante, DespuÃ©s)</p>
                        <input type="file" id="fotoLimpieza${airCounter}" accept="image/*" multiple style="display: none;">
                    </div>
                    <div class="photo-preview" id="fotoLimpiezaPreview${airCounter}"></div>
                </div>
                
                <div class="form-group">
                    <label>Evidencia de estado del equipo</label>
                    <div class="photo-upload" onclick="document.getElementById('fotoEstado${airCounter}').click()">
                        <i class="fas fa-camera"></i>
                        <p>Haga clic para agregar fotos del estado del equipo</p>
                        <input type="file" id="fotoEstado${airCounter}" accept="image/*" multiple style="display: none;">
                    </div>
                    <div class="photo-preview" id="fotoEstadoPreview${airCounter}"></div>
                </div>
            `;
            
            document.getElementById('aires-container').appendChild(newAirSection);
            
            // Configurar eventos para el nuevo aire
            setupPhotoUpload(`fotoLimpieza${airCounter}`, `fotoLimpiezaPreview${airCounter}`);
            setupPhotoUpload(`fotoEstado${airCounter}`, `fotoEstadoPreview${airCounter}`);
            
            // Configurar evento para mostrar/ocultar activo claro
            document.querySelectorAll(`input[name="activoClaro${airCounter}"]`).forEach(radio => {
                radio.addEventListener('change', function() {
                    const container = document.getElementById(`activoClaroContainer${airCounter}`);
                    if (this.value === 'Si') {
                        container.style.display = 'block';
                    } else {
                        container.style.display = 'none';
                    }
                });
            });
            
            // Configurar evento para eliminar este aire
            document.querySelector(`[data-air-id="${airCounter}"]`).addEventListener('click', function() {
                if (confirm('Â¿EstÃ¡ seguro de que desea eliminar este aire acondicionado?')) {
                    document.getElementById(`air-section-${airCounter}`).remove();
                }
            });
            
            // Mostrar el botÃ³n de eliminar para el primer aire si hay mÃ¡s de uno
            if (airCounter > 1) {
                document.querySelector('[data-air-id="1"]').style.display = 'block';
            }
        });

        // Manejo de subida de fotos
        const setupPhotoUpload = (inputId, previewId) => {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            if (input && preview) {
                input.addEventListener('change', function() {
                    preview.innerHTML = '';
                    
                    for (const file of this.files) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const photoItem = document.createElement('div');
                            photoItem.className = 'photo-item';
                            
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            
                            const removeBtn = document.createElement('div');
                            removeBtn.className = 'remove-photo';
                            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                            removeBtn.addEventListener('click', () => photoItem.remove());
                            
                            const caption = document.createElement('div');
                            caption.className = 'photo-caption';
                            caption.textContent = file.name.length > 20 ? file.name.substring(0, 17) + '...' : file.name;
                            
                            photoItem.appendChild(img);
                            photoItem.appendChild(removeBtn);
                            photoItem.appendChild(caption);
                            preview.appendChild(photoItem);
                        };
                        
                        reader.readAsDataURL(file);
                    }
                });
            }
        };

        // Configurar los inputs de fotos para el primer aire
        setupPhotoUpload('fotoLimpieza1', 'fotoLimpiezaPreview1');
        setupPhotoUpload('fotoEstado1', 'fotoEstadoPreview1');

        // GeneraciÃ³n de PDF
        document.getElementById('generatePdf').addEventListener('click', function() {
            generatePDF();
        });

        // FunciÃ³n para generar el PDF
        function generatePDF() {
            showLoading('Generando PDF...');
            
            // Usamos setTimeout para permitir que la animaciÃ³n de carga se muestre
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // TÃ­tulo del documento
                doc.setFontSize(20);
                doc.setTextColor(40, 40, 40);
                doc.text('REPORTE TÃCNICO - AIRES ACONDICIONADOS', 105, 20, { align: 'center' });
                
                // InformaciÃ³n general
                doc.setFontSize(12);
                doc.text(`PaÃ­s: ${document.getElementById('pais').value}`, 20, 35);
                doc.text(`Fecha: ${document.getElementById('fecha').value}`, 20, 45);
                doc.text(`Identificador: ${document.getElementById('identificador').value}`, 20, 55);
                
                doc.text(`ID Sitio: ${document.getElementById('idSitio').value}`, 110, 35);
                doc.text(`Nombre Sitio: ${document.getElementById('nombreSitio').value}`, 110, 45);
                
                // InformaciÃ³n del sitio
                doc.text(`RegiÃ³n: ${document.getElementById('region').value}`, 20, 70);
                doc.text(`Departamento: ${document.getElementById('departamento').value}`, 20, 80);
                doc.text(`Tipo: ${document.getElementById('tipoSitio').value}`, 20, 90);
                doc.text(`CategorÃ­a: ${document.getElementById('categoria').value}`, 20, 100);
                
                doc.text(`Latitud: ${document.getElementById('latitud').value}`, 110, 70);
                doc.text(`Longitud: ${document.getElementById('longitud').value}`, 110, 80);
                
                // Personal
                doc.text(`Supervisor: ${document.getElementById('supervisor').value}`, 20, 115);
                doc.text(`Supervisor Claro: ${document.getElementById('supervisorClaro').value}`, 20, 125);
                
                doc.text(`Empresa: ${document.getElementById('empresa').value}`, 110, 115);
                doc.text(`TÃ©cnico: ${document.getElementById('tecnico').value}`, 110, 125);
                
                // InformaciÃ³n de aires acondicionados
                let yPosition = 145;
                
                for (let i = 1; i <= airCounter; i++) {
                    const airSection = document.getElementById(`air-section-${i}`);
                    if (airSection) {
                        if (yPosition > 240) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        doc.setFontSize(14);
                        doc.setTextColor(30, 64, 175);
                        doc.text(`Aire Acondicionado #${i}`, 20, yPosition);
                        yPosition += 10;
                        
                        doc.setFontSize(10);
                        doc.setTextColor(0, 0, 0);
                        
                        doc.text(`Tipo: ${document.getElementById(`tipoAire${i}`).value}`, 20, yPosition);
                        doc.text(`Capacidad: ${document.getElementById(`capacidadAire${i}`).value} BTU`, 80, yPosition);
                        yPosition += 7;
                        
                        doc.text(`Marca: ${document.getElementById(`marcaEquipo${i}`).value}`, 20, yPosition);
                        doc.text(`Serie: ${document.getElementById(`serieEquipo${i}`).value}`, 80, yPosition);
                        yPosition += 7;
                        
                        doc.text(`Modelo: ${document.getElementById(`modeloEquipo${i}`).value}`, 20, yPosition);
                        doc.text(`Refrigerante: ${document.getElementById(`refrigerante${i}`).value}`, 80, yPosition);
                        yPosition += 7;
                        
                        const activoClaro = document.querySelector(`input[name="activoClaro${i}"]:checked`).value;
                        doc.text(`Activo Claro: ${activoClaro}`, 20, yPosition);
                        if (activoClaro === 'Si') {
                            doc.text(`CÃ³digo: ${document.getElementById(`activoClaroCodigo${i}`).value}`, 80, yPosition);
                        }
                        yPosition += 10;
                    }
                }
                
                // Observaciones
                if (document.getElementById('observaciones').value) {
                    if (yPosition > 200) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFontSize(12);
                    doc.text('Observaciones Generales:', 20, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(10);
                    const splitObservations = doc.splitTextToSize(document.getElementById('observaciones').value, 170);
                    doc.text(splitObservations, 20, yPosition);
                }
                
                // Guardar el PDF
                generatedPdf = doc;
                const pdfBlob = doc.output('blob');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                
                // Crear enlace de descarga
                const downloadLink = document.createElement('a');
                downloadLink.href = pdfUrl;
                const siteName = document.getElementById('idSitio').value || 'reporte';
                const date = new Date().toISOString().slice(0, 10);
                downloadLink.download = `Reporte_${siteName}_${date}.pdf`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                hideLoading();
                
                // Mostrar modal para enviar por correo
                document.getElementById('emailSubject').value = `Reporte TÃ©cnico - ${document.getElementById('nombreSitio').value}`;
                document.getElementById('emailMessage').value = `Adjunto se encuentra el reporte tÃ©cnico del sitio ${document.getElementById('nombreSitio').value} (${document.getElementById('idSitio').value}) realizado el ${document.getElementById('fecha').value}.`;
                
                setTimeout(() => {
                    document.getElementById('emailModal').style.display = 'flex';
                }, 1000);
            }, 1500);
        }

        // Enviar por correo
        document.getElementById('sendEmail').addEventListener('click', function() {
            const emailTo = document.getElementById('emailTo').value;
            const emailSubject = document.getElementById('emailSubject').value;
            const emailMessage = document.getElementById('emailMessage').value;
            
            if (!emailTo) {
                alert('Por favor, ingrese un destinatario');
                return;
            }
            
            showLoading('Enviando correo...');
            
            // Convertir PDF a base64 para adjuntarlo
            const pdfBlob = generatedPdf.output('blob');
            const reader = new FileReader();
            reader.readAsDataURL(pdfBlob);
            reader.onloadend = function() {
                const base64data = reader.result.split(',')[1];
                
                // ParÃ¡metros para EmailJS
                const templateParams = {
                    to_email: emailTo,
                    subject: emailSubject,
                    message: emailMessage,
                    attachment: base64data,
                    attachment_name: `Reporte_${document.getElementById('idSitio').value}_${new Date().toISOString().slice(0, 10)}.pdf`
                };
                
                // Enviar correo usando EmailJS
                emailjs.send('TU_SERVICE_ID', 'TU_TEMPLATE_ID', templateParams)
                    .then(function(response) {
                        hideLoading();
                        alert('Correo enviado con Ã©xito!');
                        document.getElementById('emailModal').style.display = 'none';
                    }, function(error) {
                        hideLoading();
                        alert('Error al enviar el correo: ' + JSON.stringify(error));
                    });
            };
        });

        // Cancelar envÃ­o de correo
        document.getElementById('cancelEmail').addEventListener('click', function() {
            document.getElementById('emailModal').style.display = 'none';
        });

        // Mostrar loading
        function showLoading(text) {
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading').style.display = 'flex';
        }

        // Ocultar loading
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Limpiar firma
        document.getElementById('clearSignature').addEventListener('click', function() {
            const canvas = document.getElementById('signaturePad');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Enviar formulario
        document.getElementById('submitForm').addEventListener('click', function() {
            generatePDF();
        });

        // Limpiar formulario
        document.getElementById('resetForm').addEventListener('click', function() {
            if (confirm('Â¿EstÃ¡ seguro de que desea limpiar todo el formulario? Se perderÃ¡n todos los datos.')) {
                document.querySelectorAll('input, textarea, select').forEach(element => {
                    if (element.type === 'checkbox' || element.type === 'radio') {
                        // Para radios, establecer el valor por defecto
                        if (element.name === 'activoClaro1') {
                            element.checked = (element.value === 'No');
                            document.getElementById('activoClaroContainer1').style.display = 'none';
                        } else if (element.name === 'pruebaPresion1') {
                            element.checked = (element.value === 'No');
                        } else if (element.name === 'otroAire') {
                            element.checked = (element.value === 'No');
                        }
                    } else if (element.type !== 'file') {
                        element.value = '';
                    }
                });
                
                // Restablecer valores predeterminados para el primer aire
                document.getElementById('tipoAire1').selectedIndex = 0;
                
                // Eliminar aires adicionales
                for (let i = 2; i <= airCounter; i++) {
                    const airSection = document.getElementById(`air-section-${i}`);
                    if (airSection) {
                        airSection.remove();
                    }
                }
                airCounter = 1;
                
                // Ocultar botÃ³n de eliminar del primer aire
                document.querySelector('[data-air-id="1"]').style.display = 'none';
                
                document.querySelectorAll('.photo-preview').forEach(preview => {
                    preview.innerHTML = '';
                });
                
                const canvas = document.getElementById('signaturePad');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        });

        // Guardar borrador
        document.getElementById('saveBtn').addEventListener('click', function() {
            alert('Borrador guardado. En una implementaciÃ³n real, los datos se guardarÃ­an en el almacenamiento local.');
        });

        // Inicializar pad de firma
        const canvas = document.getElementById('signaturePad');
        if (canvas.getContext) {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }

            function draw(e) {
                if (!isDrawing) return;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }

            function stopDrawing() {
                isDrawing = false;
            }
        }
    </script>
</body>
</html>
